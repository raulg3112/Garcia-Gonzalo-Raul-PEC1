---
title: "PAC1. Anàlisi de dades òmiques (M0-157)"
author: "Raúl García"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
  pdf_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries, include=FALSE}
library(jsonlite)
library(metabolomicsWorkbenchR)
library(SummarizedExperiment)
library(ggplot2)
```

```{r input, include=FALSE}
json_data <- fromJSON("data/ST000001_AN000001.json")
```

# Descripció de la PAC

2. Quines són les seves principals diferències amb la classe `ExpressionSet`?

3. Portar a terme una anàlisi exploratòria que proporcioni una visió general del dataset en la línia del que s'ha vist en les activitats d'aquest repte.

4. Elaborar un informe que descrigui el procés que s'ha utilitzat, incloent-hi la justificació de la selecció del dataset, la seva incorporació al `SummarizedExperiment`, l'anàlisi exploratòria de les dades i la interpretació dels resultats des del punt de vista biològic. L'extensió màxima d'aquest informe (sense tenir en compte els Annexos) ha de ser de **10 pàgines**), en format PDF.

5. Crear un respositori GitHub que contingui: 

* l'informe

* l'objecte de classe `SummarizedExperiment` que contingui les dades i les metadades en format binari (.Rda)

* el codi R per a l'exploració de les dades degudament comentat (el control de versions del mateix s'ha de realitzar amb Git)

* les metadades acompanyados d'una breu descripció en un arxiu markdown


# ABSTRACT

- RESUM PROCÉS I PRINCIPALS RESULTATS

# OBJECTIUS

El principal objectiu d'aquesta activitat és, a partir d'un dataset escollit, generar un objecte de classe `SummarizedExperiment` que contingui les dades i metadades d'aquest, i a partir de l'objecte generar un anàlisi exploratori que permeti obtenir una visió general de les dades prou extensa com per poder arribar a algunes conclusions sobre aquest. 

Pel que fa a l'estudi, el seu objectiu va ser observar quines eren les conseqüències d'una mutació que es localitzava al gen FatB d'*Arabidopsis* en la resposta a les ferides. 

# MÈTODES

Es va escollir emprar les dades de l'estudi anomenat *Fatb Induction Experiment (FatBIE)*, que es pot trobar al següent [enllaç](https://www.metabolomicsworkbench.org/data/DRCCMetadata.php?Mode=Study&StudyID=ST000001). A la vegada, el DOI de l'estudi és: [10.21228/M8159B](http://dx.doi.org/10.21228/M8159B). Aquest tracta sobre una mutació (At1g08510) en el gen FatB de la planta *Arabidopsis*, de la qual es vol observar les conseqüències que comporta en la resposta de les plantes a ferides. 

L'elecció d'aquest respecte altres va ser, a més de què a simple vista sembla que conté suficients dades i metadades com per poder portar a terme un objecte `SummarizedExperiment` amb contingut, per pròpia trajectòria personal. Anteriorment vaig estar un període de temps fent pràctiques al CRAG ([Centre for Research in Agricultural Genomics](https://www.cragenomica.es/)), on vaig treballar just amb aquest tipus de planta. A més, un altre investigador del mateix laboratori treballava estudiant la resposta que tenien plantes d'*Arabidopsis* amb diferents genotips a ferides. 

Per poder portar a terme l'assaig, es va crear un `SummarizedExperiment` que conté la informació (dades/metadades) de l'estudi. A partir d'aquest, es va procedir a realitzar l'anàlisi exploratori necessari, per tal de poder entendre els resultats de l'estudi i obtendre conclusions d'aquests.

Les llibreries emprades per poder generar tant l'objecte `SummarizedExperiment` com l'anàlisi exploratori van ser `jsonlite`, `metabolomicsWorkbenchR`,  `SummarizedExperiment` i `ggplot2`, junt amb funcions bàsiques de R que no necessiten de l'instal·lació d'una llibreria per funcionar.

`SummarizedExperiment`, a diferència d'altres classes, permet una alta flexibilitat  per tal d'emmagatzemar diferents tipus de dades. Més concretament, això es deu a que és capaç d'emmagatzemar diferents dades experimentals a la vegada en el mateix objecte, permetent a la vegada emmagatzemar i gestionar metadades tant per les diferents dades experimentals com per a la informació que es troba a les files i les columnes. Aquest fet diferencia aquest tipus de classe que la d'`ExpressionSet`, la qual funciona de forma similar, però està centrada en poder emmagatzemar dades d'expressions gèniques; aquest fet fa que aquesta classe tingui una estructura més rígida. Per tant, si es volen fer estudis de dades més variades, la millor opció seria emprar `SummarizedExperiment`. Cal recalcar que `SummarizedExperiment` és una extensió d'`ExpressionSet`, i és per això que son tan semblants entre sí. 

- PROCEDIMENT GENERAL D'ANÀLISI

# RESULTATS

D'entre les diferents opcions existents per poder generar l'objecte `SummarizedExperiment`, s'ha decantat per l'ús de la llibreria `metabolomicsWorkbenchR`, que permet implementar en R les dades i metadades dels estudis de forma directe, emprant una funció junt amb certes condicions. Amb `do_query()` i les condicions `context = "study"`, `input_item = "study_id"` i `input_value = "ST000001"`, se li marca al programa l'estudi concret al que es vol adreçar, i emprant per últim `output_item = "SummarizedExperiment"` s'aconsegueix obtenir l'objecte de classe `SummarizedExperiment. A continuació es pot veure un resum de la informació que conté:

```{r}
fatBIE <- do_query(context = "study", input_item = "study_id", input_value = "ST000001", output_item = "SummarizedExperiment")
```

```{r, echo = FALSE}
fatBIE
```

Es pot observar que l'apartat `assay` no conté un nom concret (ja que com només n'hi ha 1 assaig no és necessari diferenciar-lo de cam més). En cas de volver-li afegir un nom, es pot fer ús d'`assayNames()`. De la mateixa forma, la metadata que es pot trobar fa referència bàsica per indicar d'on s'ha obtingut el `SummarizedExperiment`, però no de l'estudi en concret. Per solucionar-ho, es pot fer ús per exemple de les dades JSON de l'estudi. Carregant aquestes al programa emprant la llibreria `jsonlite`, es pot aconseguir extreure tota la informació que es pot considerar metadata i introduïr-la en el `SummarizedExperiment`, substituïnt la informació antiga per aquesta de més interés. 

```{r, echo = FALSE}
assayNames(fatBIE) <- "Metabolite Expression"

metadata(fatBIE) <- list(Project = json_data$PROJECT, Study = json_data$STUDY, 
            Subject = json_data$SUBJECT, Collection = json_data$COLLECTION, 
            Treatment = json_data$TREATMENT, SamplePrep = json_data$SAMPLEPREP, 
            Cromatography = json_data$CHROMATOGRAPHY, 
            Analysis = json_data$ANALYSIS, MS = json_data$MS)
```

Es pot fer una observació, per exemple, a la primera observació de la metadata per veure quina informació conté i com està estructurada.

```{r, echo = FALSE}
metadata(fatBIE)[1]
```

Com a primer pas de l'anàlisi exploratori de l'estudi, es podria partir de l'ús de funcions d'R com `dim()`, `str()` o `summary()` sobre les dades de l'assaig.

Es pot observar que l'estudi conté un total de `r dim(assay(fatBIE))[1]` observacions que fan referència a diferentes metabolits, relacioants amb `r dim(assay(fatBIE))[2]` columnes, que son les mostres que s'han utilitzat en aquest. Per obtenir el nom d'aquestes, es pot emprar `colnames()`

```{r, echo = FALSE}
colnames(fatBIE)
```



```{r}
# Realizar PCA
valors_pca <- prcomp(t(assay(fatBIE)), scale. = TRUE)

# Es crea un dataframe per poder visualitzar els resultats del PCA.
dades_pca <- data.frame(Mostra = colnames(assay(fatBIE)), 
                        PC1 = valors_pca$x[,1], PC2 = valors_pca$x[,2])

# Amb `ggplot()` es genera el gràfic PCA.
ggplot(dades_pca, aes(PC1, PC2)) + 
  geom_point(aes(color = fatBIE$Arabidopsis_Genotype), size = 2) +
  labs(title = "PCA de fatBIE", x = "PC1", y = "PC2") + theme_classic()
```

- ANÀLISI EXPLORATÒRIA

# DISCUSSIÓ

- REFLEXIÓ DE LES LIMITACIONS DE L'ESTUDI

# CONCLUSIONS

- SIMPLES I DIRECTES

# REFERÈNCIES

- Repositori GitHub: https://github.com/raulg3112/Garcia-Gonzalo-Raul-PEC1.git.

- *FATb Induction Experiment FatBIE*. https://www.metabolomicsworkbench.org/data/DRCCMetadata.php?Mode=Study&StudyID=ST000001. DOI: [10.21228/M8159B](http://dx.doi.org/10.21228/M8159B).

- *Example Using structToolbox*. https://bioconductor.org/packages/release/bioc/vignettes/SummarizedExperiment/inst/doc/SummarizedExperiment.html. 

- *`SummarizedExperiment` for Coordinating Experimental Assays, Samples and Regions of Interest*. https://bioconductor.org/packages/release/bioc/vignettes/SummarizedExperiment/inst/doc/SummarizedExperiment.html#introduction. 

- *`ExpressionSet` and `SummarizedExperiment`*. https://www.sthda.com/english/wiki/expressionset-and-summarizedexperiment#licence.